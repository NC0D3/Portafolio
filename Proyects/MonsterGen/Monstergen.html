<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Skeleton Viewer</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; width: 100vw; height: 100vh; }
  </style>
</head>
<body>
<canvas id="glcanvas"></canvas>

<script type="module">
const canvas = document.getElementById('glcanvas');
const gl = canvas.getContext('webgl2');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
gl.viewport(0, 0, canvas.width, canvas.height);
gl.clearColor(1, 1, 1, 1);
gl.clear(gl.COLOR_BUFFER_BIT);

// ----------- SHADERS -----------
const vsSource = `#version 300 es
in vec3 aPosition;
uniform mat4 uMatrix;
void main() {
  gl_Position = uMatrix * vec4(aPosition, 1.0);
}`;
const fsSource = `#version 300 es
precision mediump float;
out vec4 fragColor;
void main() {
  fragColor = vec4(0.0, 0.0, 0.0, 1.0);  // Black
}`;

function compileShader(gl, source, type) {
  const shader = gl.createShader(type);
  gl.shaderSource(shader, source);
  gl.compileShader(shader);
  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))
    throw new Error(gl.getShaderInfoLog(shader));
  return shader;
}

const program = gl.createProgram();
gl.attachShader(program, compileShader(gl, vsSource, gl.VERTEX_SHADER));
gl.attachShader(program, compileShader(gl, fsSource, gl.FRAGMENT_SHADER));
gl.linkProgram(program);
gl.useProgram(program);

// ----------- LOAD JSON -----------
fetch("Skeleton.json")
  .then(res => res.json())
  .then(data => {
    const joints = data.joints;
    const bones = data.bones;

    const vertices = [];
    bones.forEach(([a, b]) => {
      vertices.push(...joints[a], ...joints[b]);
    });

    const vertexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

    const aPosition = gl.getAttribLocation(program, 'aPosition');
    gl.enableVertexAttribArray(aPosition);
    gl.vertexAttribPointer(aPosition, 3, gl.FLOAT, false, 0, 0);

    const uMatrix = gl.getUniformLocation(program, 'uMatrix');

    // ---------- ISO VIEW ----------
    const isoAngle = Math.PI / 6; // 30Â°
    const cosA = Math.cos(isoAngle);
    const sinA = Math.sin(isoAngle);

    const scale = 0.2;
    const isoMatrix = new Float32Array([
       scale * cosA, scale * sinA, -scale * 0.5, 0,
      -scale,       scale,         scale * 0.5, 0,
       0,           0,             scale,       0,
       0,           0,             0,           1
    ]);

    gl.uniformMatrix4fv(uMatrix, false, isoMatrix);

    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawArrays(gl.LINES, 0, vertices.length / 3);
  });
</script>
</body>
</html>
